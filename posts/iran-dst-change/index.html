<!doctype html><html lang=fa dir=rtl><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>لغو ساعت تابستانی در ایران | Alireza Barani</title><meta name=keywords content="Daylight Saving Time,Android"><meta name=description content="مروری بر چالش‌های ناشی از لغو ساعت تابستانی و یافتن راه‌حل‌ها"><meta name=author content="Alireza Barani"><link rel=canonical href=https://alireza1219.ir/posts/iran-dst-change/><link crossorigin=anonymous href=/assets/css/stylesheet.58a8b1fe3c6cfff5147fb297398584afe89fc0f6e70b98c9ff8b5cd7c67e49ef.css integrity="sha256-WKix/jxs//UUf7KXOYWEr+ifwPbnC5jJ/4tc18Z+Se8=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://alireza1219.ir/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alireza1219.ir/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alireza1219.ir/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://alireza1219.ir/favicon/apple-touch-icon.png><link rel=mask-icon href=https://alireza1219.ir/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/vazir-font/30.1.0/font-face.min.css integrity="sha512-FOp1/1tT19/xw6wkob5zvDLQUPFTgmYy6fXIKpo/nvZyMiyhe72YNhgSRlrE/FLS8OgYFONMGvqazSVLbO2/6Q==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Monoton&display=swap" rel=stylesheet><meta property="og:title" content="لغو ساعت تابستانی در ایران"><meta property="og:description" content="مروری بر چالش‌های ناشی از لغو ساعت تابستانی و یافتن راه‌حل‌ها"><meta property="og:type" content="article"><meta property="og:url" content="https://alireza1219.ir/posts/iran-dst-change/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-22T12:19:00+03:30"><meta property="article:modified_time" content="2023-03-22T12:19:00+03:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="لغو ساعت تابستانی در ایران"><meta name=twitter:description content="مروری بر چالش‌های ناشی از لغو ساعت تابستانی و یافتن راه‌حل‌ها"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"پست‌ها","item":"https://alireza1219.ir/posts/"},{"@type":"ListItem","position":2,"name":"لغو ساعت تابستانی در ایران","item":"https://alireza1219.ir/posts/iran-dst-change/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"لغو ساعت تابستانی در ایران","name":"لغو ساعت تابستانی در ایران","description":"مروری بر چالش‌های ناشی از لغو ساعت تابستانی و یافتن راه‌حل‌ها","keywords":["Daylight Saving Time","Android"],"articleBody":"مقدمه لحظاتی مانده به بامداد ۲ فروردین ۱۴۰۲، در حال کار کردن با کامپیوتر یا گوشی‌هوشمند خودتان هستید و ناگهان شگفت‌زده می‌شوید. تلاش برای رفتن به سایت Time بی‌فایده است. عملکرد رمزسازهای OTP نیز با اختلال همراه شده. برعکس، شاید شما هم جزو چند درصد افراد خوش‌شانس بوده‌اید و متوجه تغییر یا اختلالی نمی‌شوید. اینها قسمتی از اتفاقات ناخوشایند بامداد روز گذشته بود. بنابراین تصمیم گرفتم راه‌حل مشکلات ناشی از لغو قانون ساعت تابستانی را تا حد امکان مستندسازی کنم.\nلغو ساعت تابستانی و گوشی‌های هوشمند قدیمی از زمان آخرین آپدیت گوشی اندرویدی‌تان بیشتر از ۵ سال گذشته است؟ خوشبختانه هنوز جای امیدواری وجود دارد! سیستم‌عامل اندروید اطلاعات منطقه‌های زمانی را در فایلی به نام tzdata در مسیر /system/usr/share/zoneinfo ذخیره می‌کند. نهاد IANA، پایگاه‌داده منطقه‌های زمانی را بر اساس تغییرات قوانین زمان، بروزرسانی و در اختیار همگان قرار می‌دهد. این تغییرات در نهایت توسط شرکت سازنده بر روی گوشی شما اعمال می‌شود، اما هنگامی که پشتیبانی از گوشی شما به پایان رسیده باشد اوضاع کمی متفاوت است و خودتان باید دست‌به‌کار شوید.\nآموزش پیشِ‌رو بر روی نسخه‌های 6.0.1 و 4.4.4 اندروید امتحان شده است، اما از لحاظ تئوری و به دلیل یکسان بودن ساختار فایل tzdata در نسخه‌های 4.x تا 6.x اندروید نباید مشکلی در اجرای آن وجود داشته باشد. همچنین ساختار اطلاعات منطقه‌های زمانی در اندروید 7.x به بعد دچار تغییراتی شده است، بنابراین نمی‌توانم کارکرد درست این آموزش در نسخه‌های بعد از 7.x را تأیید یا رد کنم.\nسلب مسئولیت پیش از شروع، اگر تجربه قبلی از توسعه اندروید ندارید، توصیه می‌کنم از انجام آن خودداری کنید. زیرا احتمال Soft Brick یا حتی Hard Brick شدن گوشی شما وجود دارد. پس مسئولیت این‌کار کاملاً به عهده شماست.\nآماده‌‌سازی محیط برای شروع، به دسترسی روت نیاز داریم. در صورت استفاده از یک کاستوم ریکاوری مانند TWRP، با قابلیت خواندن و نوشتن بر روی فایل‌سیستم و عدم دسترسی روت در سیستم‌عامل اندروید، مانعی جهت انجام این روش وجود ندارد.\nدر ادامه از یک توزیع مبتنی بر Debian جهت اجرای دستورات استفاده شده است، اما استفاده از توزیع‌های دیگر نیز مانعی نداشته و روش انجام کار یکسان است.\nابتدا نصب بودن jdk بر روی کامپیوتر خود را با استفاده از دستور javac -version بررسی کنید.\nsudo apt install openjdk-17-jdk # For Debian-based distros سپس نصب بودن ابزار zic را با استفاده از دستور which zic بررسی کنید. اگر خروجی دستور چیزی مانند: /usr/sbin/zic بود می‌توانید قسمت بعدی را نادیده بگیرید، در غیراینصورت نیاز به کامپایل کردن ابزار zic داریم.\nکامپایل کردن ابزار zic نصب بودن gcc و make را بر روی کامپیوتر خود بررسی کنید.\nsudo apt install make gcc # For Debian-based distros سپس یک نسخه قدیمی از tzcode{version}.tar.gz را دانلود کنید. برای مثال در ادامه از نسخه 2016b استفاده کرده‌ایم. دلیل آن نیز سازگاری با نسخه‌های قدیمی اندروید است.\nپس از دانلود نیاز به استخراج و در نهایت کامپایل zic داریم.\nمراحل کامل را می‌توانید از طریق دستورات زیر انجام دهید:\nmkdir tzcode \u0026\u0026 cd tzcode wget https://data.iana.org/time-zones/releases/tzcode2016b.tar.gz tar -xvf tzcode2016b.tar.gz make zic در صورت اجرای موفقیت‌آمیز دستور make، یک فایل اجرایی با نام zic خواهید داشت. سپس در Home Directory خود دایرکتوری جدیدی با نام newtz ساخته و فایل اجرایی zic را به آنجا منتقل کنید:\nmkdir -p ~/newtz mv -t ~/newtz zic جهت فراخوانی ابزار zic در مرحله بعد باید به شکل زیر عمل کنید:\n./zic کامپایل کردن پایگاه‌داده منطقه‌های زمانی دریافت آخرین نسخه پایگاه‌داده منطقه‌های زمانی ابتدا آخرین نسخه فایل tzdata{version}.tar.gz را از اینجا دانلود کنید. آخرین نسخه به هنگام نوشتن این پست، 2022g است.\nدر Home Directory خود یک دایرکتوری جدید با نام newtz ساخته و فایل دانلود شده را در آنجا استخراج کنید.\nmkdir -p ~/newtz cd ~/newtz wget https://data.iana.org/time-zones/releases/tzdata2022g.tar.gz tar -xvf tzdata2022g.tar.gz rm -rf tzdata2022g.tar.gz کامپایل کردن منطقه‌های زمانی حال به قسمت کامپایل منطقه‌های زمانی با کمک ابزار zic می‌رسیم. فراموش نکنید که باید در دایرکتوری newtz باشید. سپس به شکل زیر عمل کنید:\n# Be sure to be in the ~/newtz directory before running the command below zic -d data africa antarctica asia australasia etcetera europe northamerica southamerica backward backzone در صورت اجرای موفقیت‌آمیز دستور zic، یک دایرکتوری با نام ‍data حاوی منطقه‌های زمانی کامپایل شده به شکل زیر خواهید داشت:\nگردآوری فایل tzdata دانلود و کامپایل ZoneCompactor جهت تبدیل دایرکتوری data به یک فایل tzdata نیاز به برنامه‌ی جاوایی ‍ZoneCompactor.java داریم. به‌مانند قبل، پیش از اجرای دستورات باید در دایرکتوری newtz باشید.\nنحوه دانلود و کامپایل ZoneCompactor.java به شکل زیر است:\n# Be sure to be in the ~/newtz directory before running the commands below # Getting ZoneCompactor.java curl \"https://android.googlesource.com/platform/bionic/+/refs/tags/android-6.0.1_r81/libc/tools/zoneinfo/ZoneCompactor.java?format=TEXT\" | base64 -d \u003e ZoneCompactor.java # Compiling ZoneCompactor.java javac ZoneCompactor.java ساخت فایل setup پیش از اجرای ZoneCompactor نیاز به مشخص کردن منطقه‌های زمانی موجود در فایل tzdata داریم. تایپ دستی این لیست کاری بیهوده است، پس اسکریپت پایتونی مربوط به این بخش را بازنویسی کرده‌ام تا با python3 سازگار شده و به صورت کاملاً خودکار یک لیست حاوی منطقه‌های زمانی برای شما بسازد. با یک ویرایشگر متنی مانند vim در دایرکتوری newtz فایلی با نام writeSetupFile.py ساخته و اسکریپت زیر را در آن جایگذاری کنید:\nvim writeSetupFile.py # Original credits: # https://android.googlesource.com/platform/bionic/+/refs/tags/android-6.0.1_r81/libc/tools/zoneinfo/update-tzdata.py#49 from pathlib import Path REGIONS = [ \"africa\", \"antarctica\", \"asia\", \"australasia\", \"etcetera\", \"europe\", \"northamerica\", \"southamerica\", \"backward\", \"backzone\" ] def write_setup_file(): links, zones = [], [] for region in REGIONS: file_path = Path.cwd() / f\"{region}\" with open(file_path, \"r\") as f: for line in f: fields = line.split() if fields: if fields[0] == \"Link\": links.append(f\"{fields[0]} {fields[1]} {fields[2]}\") zones.append(fields[2]) elif fields[0] == \"Zone\": zones.append(fields[1]) setup_path = Path.cwd() / \"setup\" with open(setup_path, \"w\") as setup: [setup.write(f\"{link}\\n\") for link in sorted(set(links))] [setup.write(f\"{zone}\\n\") for zone in sorted(set(zones))] def main(): write_setup_file() if __name__ == \"__main__\": main() سپس آن را اجرا کنید:\npython3 writeSetupFile.py در صورت اجرای موفقیت آمیز اسکریپت، یک فایل خروجی حاوی اسم منطقه‌های زمانی با نام setup خواهید داشت.\nمرحله نهایی و ساخت tzdata در نهایت نوبت به اجرای ZoneCompactor و گردآوری فایل tzdata می‌رسد. نحوه فراخوانی ZoneCompactor به شکل زیر است:\njava ZoneCompactor و پارامترهای آن به این ترتیب هستند:\n: فایل خروجی مرحله ساخت فایل setup : آدرس دایرکتوری ساخته شده در مرحله کامپایل پایگاه‌داده منطقه‌های زمانی : فایل zone.tab که در آرشیو tzdata قرار دارد\n: آدرس دایرکتوری خروجی فایل tzdata\n: نسخه فعلی پایگاه‌داده منطقه‌های زمانی که فرمت آن باید شبیه به tzdata{current_version} باشد. آخرین نسخه در زمان نوشتن این پست tzdata2022g است.\nحال که کاربرد هر یک از پارامترها را متوجه شدیم آن را اجرا می‌کنیم، فراموش نکنید که پیش از اجرا، در دایرکتوری newtz یک دایرکتوری جدید به نام output نیز بسازید:\n# Be sure to be in the ~/newtz directory before running the commands below mkdir -p output java ZoneCompactor setup data zone.tab output tzdata2022g در صورت موفقیت‌آمیز بودن اجرا، فایل tzdata درون دایرکتوری output قابل دسترس است.\nانتقال tzdata به گوشی جهت انتقال و جایگزینی فایل جدید با فایل قدیمی راه‌های متعددی وجود دارد، در صورت داشتن دسترسی روت در سیستم‌عامل اندروید می‌توانید از یک Root Explorer استفاده کنید یا از طریق adb و دستور adb shell آن را جایگزین کنید. پیشنهاد می‌کنم این کار را از طریق بوت کردن یک کاستوم ریکاوری مانند TWRP و دستور adb shell انجام دهید. در ادامه نیز همین روش را پیش خواهیم برد.\nبرای شروع لازم است تا گوشی خودتان را در حالت ریکاوری بوت کنید. پس از آن گوشی را با کمک کابل به کامپیوتر خود متصل کنید.\nدر صورت نصب نبودن adb، می‌توانید با استفاده از دستور زیر آن را نصب کنید:\nsudo apt install android-tools-adb سپس با استفاده از دستور adb devices، درست شناسایی شدن گوشی خود توسط کامپیوتر را بررسی کرده و در ادامه با استفاده از دستور adb shell به شِل گوشی خود دسترسی پیدا کنید.\nMount بودن فایل‌سیستم را با استفاده از دستور df -h بررسی کرده و در صورت Mount نبودن دستور زیر را اجرا کنید:\nmount /system حال در یک تَب ترمینال دیگر با استفاده از دستور adb push، فایل tzdata ساخته شده را به حافظه داخلی گوشی خود انتقال دهید. توجه داشته باشید که ممکن است مسیر حافظه داخلی گوشی شما با مسیر استفاده شده در این آموزش، متفاوت باشد!\nadb push ~/newtz/output/tzdata /sdcard/tzdata به شِل گوشی برگشته و دستورات زیر را اجرا کنید:\ncd /system/usr/share/zoneinfo # Change the working directory mv tzdata tzdata.old # Backup the old tzdata in case something went wrong mv /sdcard/tzdata tzdata # Move the new tzdata into the current directory chmod 644 tzdata # Change the permissions حال با وارد کردن دستور reboot در شِل گوشی، از حالت ریکاوری خارج شوید. پس از راه‌اندازی مجدد و بوت شدن، به تنظیمات زمان و تاریخ گوشی خود رفته و خودکار بودن منطقه زمانی و تاریخ‌و‌ساعت را بررسی کنید. اگر در حالت خودکار، منطقه زمانی دستگاه نمایانگر Iran Standard Time باشد، فرآیند جایگزینی و بروزرسانی با موفقیت انجام شده است.\nاشکال یابی در صورتی که پس از اعمال تغییرات تازه، تمام منطقه‌های زمانی نمایانگر زمان +00:00 هستند و عملکرد گوشی شما در مواردی مانند شناسایی سیم‌کارت و شبکه دچار اختلال شده، می‌توانید راه‌های زیر را امتحان کنید:\nدریافت فایل از پیش گردآوری شده tzdata ابتدا فایل tzdata حاوی آخرین تغییرات منطقه‌های زمانی را از اینجا دریافت کنید. سپس آموزش را از قسمت انتقال tzdata به گوشی ادامه دهید.\nچک کردن نسخه zic آیا از ابزار zic درون سیستم‌عامل خود استفاده می‌کنید؟ این احتمال وجود دارد که ابزار zic سیستم‌عامل شما برای نسخه اندرویدتان بیش از اندازه جدید باشد. برای مثال نسخه 2.35 از ابزار zic که به صورت پیش‌فرض در Ubuntu 22.04 LTS وجود دارد، باعث ایجاد مشکل در برخی از گوشی‌های قدیمی شرکت Xiaomi که MIUI 10 را اجرا می‌کنند، می‌شود.\nبا اجرای دستور zic --version می‌توانید نسخه فعلی ابزار zic را مشاهده کنید. اگر نسخه نمایان شده بزرگ‌تر از 2.31 بود، می‌توانید آموزش را با یک نسخه قدیمی‌تر نیز امتحان کنید. برای دسترسی به نسخه‌های قدیمی‌تر به دو شکل می‌توان عمل کرد:\n۱- کامپایل کردن یک نسخه قدیمی از ابزار zic\n۲- استخراج ابزار zic از پکیج‌های قدیمی libc\nدر صورت استفاده از یک توزیع مبتنی بر Debian مانند Ubuntu، بهتر است از روش دوم استفاده کنید. ابتدا نسخه‌های قدیمی پکیج libc را از اینجا پیدا کرده و پکیج آن را مطابق با معماری پردازنده کامپیوتر خود دانلود کنید. برای مثال روند انجام این کار در یک کامپیوتر با پردازنده ۶۴بیتی و نسخه 2.31 از پکیج libc به شکل زیر است:\n(پیش از شروع دایرکتوری خود را به newtz تغییر دهید)\n# Be sure to be in the ~/newtz directory before running the commands below wget http://security.ubuntu.com/ubuntu/pool/main/g/glibc/libc-bin_2.31-0ubuntu9.7_amd64.deb dpkg-deb --fsys-tarfile libc-bin_2.31-0ubuntu9.7_amd64.deb | tar -x ./usr/sbin/zic \u0026\u0026 mv usr/sbin/zic zic rm -rf usr حال یک نسخه قابل‌اجرا از ابزار zic در دایرکتوری newtz خواهید داشت. پس از آن، آموزش را از قسمت کامپایل کردن منطقه‌های زمانی ادامه دهید و توجه کنید که باید دستور این قسمت را به شکل زیر فراخوانی کرده تا از ابزار zic موجود در دایرکتوری newtz جهت کامپایل منطقه‌های زمانی استفاده شود:\n./zic -d data africa antarctica asia australasia etcetera europe northamerica southamerica backward backzone پیش از اجرای دستور فوق بهتر است تا دایرکتوری data را حذف کنید.\nبازگردانی تغییرات اعمال شده در صورت موفقیت‌آمیز نبودن هیچ‌یک راه‌حل‌های مطرح شده، باید فایل قدیمی tzdata را بازگردانی کنید. این به معنای سازگار نبودن آموزش با نسخه اندروید گوشی شما یا استفاده شرکت سازنده دستگاه از روش‌های دیگر جهت ایجاد tzdata می‌باشد.\nجهت بازگردانی فایل tzdata قدیمی، گوشی خود را مجدداً در حالت ریکاوری قرار داده و آن را با کمک کابل به کامپیوتر خود متصل کنید. با استفاده از دستور adb shell به شِل گوشی خود دسترسی پیدا کنید. سپس Mount بودن فایل‌سیستم را بررسی کرده و دستورات زیر را اجرا کنید:\ncd /system/usr/share/zoneinfo rm -rf tzdata mv tzdata.old tzdata reboot سخن پایانی این پست به‌مرور زمان و در مواجهه با چالش‌های تازه یا بهبود راه‌حل‌ها، به‌روزرسانی خواهد شد.\n","wordCount":"1950","inLanguage":"fa","datePublished":"2023-03-22T12:19:00+03:30","dateModified":"2023-03-22T12:19:00+03:30","author":{"@type":"Person","name":"Alireza Barani"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://alireza1219.ir/posts/iran-dst-change/"},"publisher":{"@type":"Organization","name":"Alireza Barani","logo":{"@type":"ImageObject","url":"https://alireza1219.ir/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://alireza1219.ir/ accesskey=h title="Alireza Barani (Alt + H)"><img src=https://alireza1219.ir/icon.png alt=logo aria-label=logo height=32>Alireza Barani</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><button id=menu-trigger aria-haspopup=menu aria-label="Menu Button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul id=menu class=hidden><li><a href=https://alireza1219.ir/search title=جستجو><span>جستجو</span></a></li><li><a href=https://alireza1219.ir/tags title=برچسب‌ها><span>برچسب‌ها</span></a></li><li><a href=https://alireza1219.ir/about title="درباره من"><span>درباره من</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://alireza1219.ir/>خانه</a>&nbsp;»&nbsp;<a href=https://alireza1219.ir/posts/>پست‌ها</a></div><h1 class=post-title>لغو ساعت تابستانی در ایران</h1><div class=post-meta><span title='2023-03-22 12:19:00 +0330 +0330'>مارس 22, 2023</span>&nbsp;·&nbsp;Alireza Barani</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>فهرست مطالب</span></summary><div class=inner><ul><li><a href=#%d9%85%d9%82%d8%af%d9%85%d9%87 aria-label=مقدمه>مقدمه</a></li><li><a href=#%d9%84%d8%ba%d9%88-%d8%b3%d8%a7%d8%b9%d8%aa-%d8%aa%d8%a7%d8%a8%d8%b3%d8%aa%d8%a7%d9%86%db%8c-%d9%88-%da%af%d9%88%d8%b4%db%8c%d9%87%d8%a7%db%8c-%d9%87%d9%88%d8%b4%d9%85%d9%86%d8%af-%d9%82%d8%af%db%8c%d9%85%db%8c aria-label="لغو ساعت تابستانی و گوشی‌های هوشمند قدیمی">لغو ساعت تابستانی و گوشی‌های هوشمند قدیمی</a><ul><li><a href=#%d8%b3%d9%84%d8%a8-%d9%85%d8%b3%d8%a6%d9%88%d9%84%db%8c%d8%aa aria-label="سلب مسئولیت">سلب مسئولیت</a></li><li><a href=#%d8%a2%d9%85%d8%a7%d8%af%d9%87%d8%b3%d8%a7%d8%b2%db%8c-%d9%85%d8%ad%db%8c%d8%b7 aria-label="آماده‌‌سازی محیط">آماده‌‌سازی محیط</a></li><li><a href=#%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-%da%a9%d8%b1%d8%af%d9%86-%d8%a7%d8%a8%d8%b2%d8%a7%d8%b1-zic aria-label="کامپایل کردن ابزار zic">کامپایل کردن ابزار zic</a></li><li><a href=#%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-%da%a9%d8%b1%d8%af%d9%86-%d9%be%d8%a7%db%8c%da%af%d8%a7%d9%87%d8%af%d8%a7%d8%af%d9%87-%d9%85%d9%86%d8%b7%d9%82%d9%87%d9%87%d8%a7%db%8c-%d8%b2%d9%85%d8%a7%d9%86%db%8c aria-label="کامپایل کردن پایگاه‌داده منطقه‌های زمانی">کامپایل کردن پایگاه‌داده منطقه‌های زمانی</a><ul><li><a href=#%d8%af%d8%b1%db%8c%d8%a7%d9%81%d8%aa-%d8%a2%d8%ae%d8%b1%db%8c%d9%86-%d9%86%d8%b3%d8%ae%d9%87-%d9%be%d8%a7%db%8c%da%af%d8%a7%d9%87%d8%af%d8%a7%d8%af%d9%87-%d9%85%d9%86%d8%b7%d9%82%d9%87%d9%87%d8%a7%db%8c-%d8%b2%d9%85%d8%a7%d9%86%db%8c aria-label="دریافت آخرین نسخه پایگاه‌داده منطقه‌های زمانی">دریافت آخرین نسخه پایگاه‌داده منطقه‌های زمانی</a></li><li><a href=#%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-%da%a9%d8%b1%d8%af%d9%86-%d9%85%d9%86%d8%b7%d9%82%d9%87%d9%87%d8%a7%db%8c-%d8%b2%d9%85%d8%a7%d9%86%db%8c aria-label="کامپایل کردن منطقه‌های زمانی">کامپایل کردن منطقه‌های زمانی</a></li></ul></li><li><a href=#%da%af%d8%b1%d8%af%d8%a2%d9%88%d8%b1%db%8c-%d9%81%d8%a7%db%8c%d9%84-tzdata aria-label="گردآوری فایل tzdata">گردآوری فایل tzdata</a><ul><li><a href=#%d8%af%d8%a7%d9%86%d9%84%d9%88%d8%af-%d9%88-%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-zonecompactor aria-label="دانلود و کامپایل ZoneCompactor">دانلود و کامپایل ZoneCompactor</a></li><li><a href=#%d8%b3%d8%a7%d8%ae%d8%aa-%d9%81%d8%a7%db%8c%d9%84-setup aria-label="ساخت فایل setup">ساخت فایل setup</a></li><li><a href=#%d9%85%d8%b1%d8%ad%d9%84%d9%87-%d9%86%d9%87%d8%a7%db%8c%db%8c-%d9%88-%d8%b3%d8%a7%d8%ae%d8%aa-tzdata aria-label="مرحله نهایی و ساخت tzdata">مرحله نهایی و ساخت tzdata</a></li></ul></li><li><a href=#%d8%a7%d9%86%d8%aa%d9%82%d8%a7%d9%84-tzdata-%d8%a8%d9%87-%da%af%d9%88%d8%b4%db%8c aria-label="انتقال tzdata به گوشی">انتقال tzdata به گوشی</a></li><li><a href=#%d8%a7%d8%b4%da%a9%d8%a7%d9%84-%db%8c%d8%a7%d8%a8%db%8c aria-label="اشکال یابی">اشکال یابی</a><ul><li><a href=#%d8%af%d8%b1%db%8c%d8%a7%d9%81%d8%aa-%d9%81%d8%a7%db%8c%d9%84-%d8%a7%d8%b2-%d9%be%db%8c%d8%b4-%da%af%d8%b1%d8%af%d8%a2%d9%88%d8%b1%db%8c-%d8%b4%d8%af%d9%87-tzdata aria-label="دریافت فایل از پیش گردآوری شده tzdata">دریافت فایل از پیش گردآوری شده tzdata</a></li><li><a href=#%da%86%da%a9-%da%a9%d8%b1%d8%af%d9%86-%d9%86%d8%b3%d8%ae%d9%87-zic aria-label="چک کردن نسخه zic">چک کردن نسخه zic</a></li><li><a href=#%d8%a8%d8%a7%d8%b2%da%af%d8%b1%d8%af%d8%a7%d9%86%db%8c-%d8%aa%d8%ba%db%8c%db%8c%d8%b1%d8%a7%d8%aa-%d8%a7%d8%b9%d9%85%d8%a7%d9%84-%d8%b4%d8%af%d9%87 aria-label="بازگردانی تغییرات اعمال شده">بازگردانی تغییرات اعمال شده</a></li></ul></li></ul></li><li><a href=#%d8%b3%d8%ae%d9%86-%d9%be%d8%a7%db%8c%d8%a7%d9%86%db%8c aria-label="سخن پایانی">سخن پایانی</a></li></ul></div></details></div><div class=post-content><h2 id=مقدمه>مقدمه<a hidden class=anchor aria-hidden=true href=#مقدمه>#</a></h2><p>لحظاتی مانده به بامداد ۲ فروردین ۱۴۰۲، در حال کار کردن با کامپیوتر یا گوشی‌هوشمند خودتان هستید و ناگهان شگفت‌زده می‌شوید. تلاش برای رفتن به سایت <a href=https://time.ir target=_blank rel="noopener noreferrer">Time</a> بی‌فایده است. عملکرد رمزسازهای OTP نیز با اختلال همراه شده. برعکس، شاید شما هم جزو چند درصد افراد خوش‌شانس بوده‌اید و متوجه تغییر یا اختلالی نمی‌شوید. اینها قسمتی از اتفاقات ناخوشایند بامداد روز گذشته بود. بنابراین تصمیم گرفتم راه‌حل مشکلات ناشی از لغو قانون ساعت تابستانی را تا حد امکان مستندسازی کنم.</p><h2 id=لغو-ساعت-تابستانی-و-گوشیهای-هوشمند-قدیمی>لغو ساعت تابستانی و گوشی‌های هوشمند قدیمی<a hidden class=anchor aria-hidden=true href=#لغو-ساعت-تابستانی-و-گوشیهای-هوشمند-قدیمی>#</a></h2><p>از زمان آخرین آپدیت گوشی اندرویدی‌تان بیشتر از ۵ سال گذشته است؟ خوشبختانه هنوز جای امیدواری وجود دارد! سیستم‌عامل اندروید اطلاعات منطقه‌های زمانی را در فایلی به نام <code>tzdata</code> در مسیر <code>/system/usr/share/zoneinfo</code> ذخیره می‌کند. نهاد IANA، پایگاه‌داده منطقه‌های زمانی را بر اساس تغییرات قوانین زمان، بروزرسانی و در اختیار همگان قرار می‌دهد. این تغییرات در نهایت توسط شرکت سازنده بر روی گوشی شما اعمال می‌شود، اما هنگامی که پشتیبانی از گوشی شما به پایان رسیده باشد اوضاع کمی متفاوت است و خودتان باید دست‌به‌کار شوید.</p><p>آموزش پیشِ‌رو بر روی نسخه‌های 6.0.1 و 4.4.4 اندروید امتحان شده است، اما از لحاظ تئوری و به دلیل یکسان بودن ساختار فایل <code>tzdata</code> در نسخه‌های 4.x تا 6.x اندروید نباید مشکلی در اجرای آن وجود داشته باشد. همچنین ساختار اطلاعات منطقه‌های زمانی در اندروید 7.x به بعد دچار تغییراتی شده است، بنابراین نمی‌توانم کارکرد درست این آموزش در نسخه‌های بعد از 7.x را تأیید یا رد کنم.</p><h3 id=سلب-مسئولیت>سلب مسئولیت<a hidden class=anchor aria-hidden=true href=#سلب-مسئولیت>#</a></h3><p>پیش از شروع، اگر تجربه قبلی از توسعه اندروید ندارید، توصیه می‌کنم از انجام آن خودداری کنید. زیرا احتمال Soft Brick یا حتی Hard Brick شدن گوشی شما وجود دارد. <strong>پس مسئولیت این‌کار کاملاً به عهده شماست.</strong></p><h3 id=آمادهسازی-محیط>آماده‌‌سازی محیط<a hidden class=anchor aria-hidden=true href=#آمادهسازی-محیط>#</a></h3><p>برای شروع، به دسترسی روت نیاز داریم. در صورت استفاده از یک کاستوم ریکاوری مانند TWRP، با قابلیت خواندن و نوشتن بر روی فایل‌سیستم و عدم دسترسی روت در سیستم‌عامل اندروید، مانعی جهت انجام این روش وجود ندارد.</p><p>در ادامه از یک توزیع مبتنی بر Debian جهت اجرای دستورات استفاده شده است، اما استفاده از توزیع‌های دیگر نیز مانعی نداشته و روش انجام کار یکسان است.</p><p>ابتدا نصب بودن <code>jdk</code> بر روی کامپیوتر خود را با استفاده از دستور <code>javac -version</code> بررسی کنید.</p><pre tabindex=0><code>sudo apt install openjdk-17-jdk # For Debian-based distros
</code></pre><p>سپس نصب بودن ابزار <code>zic</code> را با استفاده از دستور <code>which zic</code> بررسی کنید. اگر خروجی دستور چیزی مانند: <code>/usr/sbin/zic</code> بود می‌توانید قسمت بعدی را نادیده بگیرید، در غیراینصورت نیاز به کامپایل کردن ابزار <code>zic</code> داریم.</p><h3 id=کامپایل-کردن-ابزار-zic>کامپایل کردن ابزار zic<a hidden class=anchor aria-hidden=true href=#کامپایل-کردن-ابزار-zic>#</a></h3><p>نصب بودن <code>gcc</code> و <code>make</code> را بر روی کامپیوتر خود بررسی کنید.</p><pre tabindex=0><code>sudo apt install make gcc # For Debian-based distros
</code></pre><p>سپس یک نسخه قدیمی از <code>tzcode{version}.tar.gz</code> را <a href=https://data.iana.org/time-zones/releases target=_blank rel="noopener noreferrer">دانلود</a> کنید. برای مثال در ادامه از نسخه <code>2016b</code> استفاده کرده‌ایم. دلیل آن نیز سازگاری با نسخه‌های قدیمی اندروید است.</p><p>پس از دانلود نیاز به استخراج و در نهایت کامپایل <code>zic</code> داریم.</p><p>مراحل کامل را می‌توانید از طریق دستورات زیر انجام دهید:</p><pre tabindex=0><code>mkdir tzcode &amp;&amp; cd tzcode

wget https://data.iana.org/time-zones/releases/tzcode2016b.tar.gz

tar -xvf tzcode2016b.tar.gz

make zic
</code></pre><p>در صورت اجرای موفقیت‌آمیز دستور <code>make</code>، یک فایل اجرایی با نام <code>zic</code> خواهید داشت. سپس در Home Directory خود دایرکتوری جدیدی با نام <code>newtz</code> ساخته و فایل اجرایی <code>zic</code> را به آنجا منتقل کنید:</p><pre tabindex=0><code>mkdir -p ~/newtz
mv -t ~/newtz zic
</code></pre><p>جهت فراخوانی ابزار <code>zic</code> در مرحله بعد باید به شکل زیر عمل کنید:</p><pre tabindex=0><code>./zic 
</code></pre><h3 id=کامپایل-کردن-پایگاهداده-منطقههای-زمانی>کامپایل کردن پایگاه‌داده منطقه‌های زمانی<a hidden class=anchor aria-hidden=true href=#کامپایل-کردن-پایگاهداده-منطقههای-زمانی>#</a></h3><h4 id=دریافت-آخرین-نسخه-پایگاهداده-منطقههای-زمانی>دریافت آخرین نسخه پایگاه‌داده منطقه‌های زمانی<a hidden class=anchor aria-hidden=true href=#دریافت-آخرین-نسخه-پایگاهداده-منطقههای-زمانی>#</a></h4><p>ابتدا آخرین نسخه فایل <code>tzdata{version}.tar.gz</code> را از <a href=https://data.iana.org/time-zones/releases/ target=_blank rel="noopener noreferrer">اینجا</a> دانلود کنید. آخرین نسخه به هنگام نوشتن این پست، <code>2022g</code> است.</p><p>در Home Directory خود یک دایرکتوری جدید با نام <code>newtz</code> ساخته و فایل دانلود شده را در آنجا استخراج کنید.</p><pre tabindex=0><code>mkdir -p ~/newtz

cd ~/newtz

wget https://data.iana.org/time-zones/releases/tzdata2022g.tar.gz

tar -xvf tzdata2022g.tar.gz

rm -rf tzdata2022g.tar.gz
</code></pre><h4 id=کامپایل-کردن-منطقههای-زمانی>کامپایل کردن منطقه‌های زمانی<a hidden class=anchor aria-hidden=true href=#کامپایل-کردن-منطقههای-زمانی>#</a></h4><p>حال به قسمت کامپایل منطقه‌های زمانی با کمک ابزار <code>zic</code> می‌رسیم. فراموش نکنید که باید در دایرکتوری <code>newtz</code> باشید. سپس به شکل زیر عمل کنید:</p><pre tabindex=0><code># Be sure to be in the ~/newtz directory before running the command below

zic -d data africa antarctica asia australasia etcetera europe northamerica southamerica backward backzone
</code></pre><p>در صورت اجرای موفقیت‌آمیز دستور <code>zic</code>، یک دایرکتوری با نام ‍<code>data</code> حاوی منطقه‌های زمانی کامپایل شده به شکل زیر خواهید داشت:</p><p><img loading=lazy src=https://files.alireza1219.ir/img/2023/03/zic-data-dir.jpg alt="Zic data directory"></p><h3 id=گردآوری-فایل-tzdata>گردآوری فایل tzdata<a hidden class=anchor aria-hidden=true href=#گردآوری-فایل-tzdata>#</a></h3><h4 id=دانلود-و-کامپایل-zonecompactor>دانلود و کامپایل ZoneCompactor<a hidden class=anchor aria-hidden=true href=#دانلود-و-کامپایل-zonecompactor>#</a></h4><p>جهت تبدیل دایرکتوری <code>data</code> به یک فایل <code>tzdata</code> نیاز به برنامه‌ی جاوایی ‍<code>ZoneCompactor.java</code> داریم. به‌مانند قبل، پیش از اجرای دستورات باید در دایرکتوری <code>newtz</code> باشید.</p><p>نحوه دانلود و کامپایل <code>ZoneCompactor.java</code> به شکل زیر است:</p><pre tabindex=0><code># Be sure to be in the ~/newtz directory before running the commands below

# Getting ZoneCompactor.java
curl &#34;https://android.googlesource.com/platform/bionic/+/refs/tags/android-6.0.1_r81/libc/tools/zoneinfo/ZoneCompactor.java?format=TEXT&#34; | base64 -d &gt; ZoneCompactor.java

# Compiling ZoneCompactor.java
javac ZoneCompactor.java
</code></pre><h4 id=ساخت-فایل-setup>ساخت فایل setup<a hidden class=anchor aria-hidden=true href=#ساخت-فایل-setup>#</a></h4><p>پیش از اجرای <code>ZoneCompactor</code> نیاز به مشخص کردن منطقه‌های زمانی موجود در فایل <code>tzdata</code> داریم. تایپ دستی این لیست کاری بیهوده است، پس اسکریپت پایتونی مربوط به این بخش را بازنویسی کرده‌ام تا با <code>python3</code> سازگار شده و به صورت کاملاً خودکار یک لیست حاوی منطقه‌های زمانی برای شما بسازد. با یک ویرایشگر متنی مانند <code>vim</code> در دایرکتوری <code>newtz</code> فایلی با نام <code>writeSetupFile.py</code> ساخته و اسکریپت زیر را در آن جایگذاری کنید:</p><pre tabindex=0><code>vim writeSetupFile.py
</code></pre><pre tabindex=0><code># Original credits:
# https://android.googlesource.com/platform/bionic/+/refs/tags/android-6.0.1_r81/libc/tools/zoneinfo/update-tzdata.py#49

from pathlib import Path

REGIONS = [
   &#34;africa&#34;,
   &#34;antarctica&#34;,
   &#34;asia&#34;,
   &#34;australasia&#34;,
   &#34;etcetera&#34;,
   &#34;europe&#34;,
   &#34;northamerica&#34;,
   &#34;southamerica&#34;,
   &#34;backward&#34;,
   &#34;backzone&#34;
]

def write_setup_file():
   links, zones = [], []
   for region in REGIONS:
      file_path = Path.cwd() / f&#34;{region}&#34;
      with open(file_path, &#34;r&#34;) as f:
         for line in f:
            fields = line.split()
            if fields:
               if fields[0] == &#34;Link&#34;:
                  links.append(f&#34;{fields[0]} {fields[1]} {fields[2]}&#34;)
                  zones.append(fields[2])
               elif fields[0] == &#34;Zone&#34;:
                  zones.append(fields[1])
   setup_path = Path.cwd() / &#34;setup&#34;
   with open(setup_path, &#34;w&#34;) as setup:
      [setup.write(f&#34;{link}\n&#34;) for link in sorted(set(links))]
      [setup.write(f&#34;{zone}\n&#34;) for zone in sorted(set(zones))]

def main():
   write_setup_file()

if __name__ == &#34;__main__&#34;:
   main()
</code></pre><p>سپس آن را اجرا کنید:</p><pre tabindex=0><code>python3 writeSetupFile.py
</code></pre><p>در صورت اجرای موفقیت آمیز اسکریپت، یک فایل خروجی حاوی اسم منطقه‌های زمانی با نام <code>setup</code> خواهید داشت.</p><h4 id=مرحله-نهایی-و-ساخت-tzdata>مرحله نهایی و ساخت tzdata<a hidden class=anchor aria-hidden=true href=#مرحله-نهایی-و-ساخت-tzdata>#</a></h4><p>در نهایت نوبت به اجرای <code>ZoneCompactor</code> و گردآوری فایل <code>tzdata</code> می‌رسد. نحوه فراخوانی <code>ZoneCompactor</code> به شکل زیر است:</p><pre tabindex=0><code>java ZoneCompactor &lt;setup file&gt; &lt;data directory&gt; &lt;zone.tab file&gt; &lt;output directory&gt; &lt;tzdata version&gt;
</code></pre><p>و پارامترهای آن به این ترتیب هستند:</p><p><code>&lt;setup file></code>: فایل خروجی مرحله <a href=#%d8%b3%d8%a7%d8%ae%d8%aa-%d9%81%d8%a7%db%8c%d9%84-setup>ساخت فایل setup</a></p><p><code>&lt;data directory></code>: آدرس دایرکتوری ساخته شده در مرحله <a href=#%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-%d9%be%d8%a7%db%8c%da%af%d8%a7%d9%87%d8%af%d8%a7%d8%af%d9%87-%d9%85%d9%86%d8%b7%d9%82%d9%87%d9%87%d8%a7%db%8c-%d8%b2%d9%85%d8%a7%d9%86%db%8c>کامپایل پایگاه‌داده منطقه‌های زمانی</a></p><p><code>&lt;zone.tab file></code>: فایل <code>zone.tab</code> که در آرشیو <code>tzdata</code> قرار دارد</p><p><code>&lt;output directory></code>: آدرس دایرکتوری خروجی فایل <code>tzdata</code></p><p><code>&lt;tzdata version></code>: نسخه فعلی پایگاه‌داده منطقه‌های زمانی که فرمت آن باید شبیه به <code>tzdata{current_version}</code> باشد. آخرین نسخه در زمان نوشتن این پست <code>tzdata2022g</code> است.</p><p>حال که کاربرد هر یک از پارامترها را متوجه شدیم آن را اجرا می‌کنیم، فراموش نکنید که پیش از اجرا، در دایرکتوری <code>newtz</code> یک دایرکتوری جدید به نام <code>output</code> نیز بسازید:</p><pre tabindex=0><code># Be sure to be in the ~/newtz directory before running the commands below

mkdir -p output

java ZoneCompactor setup data zone.tab output tzdata2022g
</code></pre><p>در صورت موفقیت‌آمیز بودن اجرا، فایل <code>tzdata</code> درون دایرکتوری <code>output</code> قابل دسترس است.</p><h3 id=انتقال-tzdata-به-گوشی>انتقال tzdata به گوشی<a hidden class=anchor aria-hidden=true href=#انتقال-tzdata-به-گوشی>#</a></h3><p>جهت انتقال و جایگزینی فایل جدید با فایل قدیمی راه‌های متعددی وجود دارد، در صورت داشتن دسترسی روت در سیستم‌عامل اندروید می‌توانید از یک Root Explorer استفاده کنید یا از طریق <code>adb</code> و دستور <code>adb shell</code> آن را جایگزین کنید. پیشنهاد می‌کنم این کار را از طریق بوت کردن یک کاستوم ریکاوری مانند TWRP و دستور <code>adb shell</code> انجام دهید. در ادامه نیز همین روش را پیش خواهیم برد.</p><p>برای شروع لازم است تا گوشی خودتان را در حالت ریکاوری بوت کنید. پس از آن گوشی را با کمک کابل به کامپیوتر خود متصل کنید.</p><p>در صورت نصب نبودن <code>adb</code>، می‌توانید با استفاده از دستور زیر آن را نصب کنید:</p><pre tabindex=0><code>sudo apt install android-tools-adb
</code></pre><p>سپس با استفاده از دستور <code>adb devices</code>، درست شناسایی شدن گوشی خود توسط کامپیوتر را بررسی کرده و در ادامه با استفاده از دستور <code>adb shell</code> به شِل گوشی خود دسترسی پیدا کنید.</p><p>Mount بودن فایل‌سیستم را با استفاده از دستور <code>df -h</code> بررسی کرده و در صورت Mount نبودن دستور زیر را اجرا کنید:</p><pre tabindex=0><code>mount /system
</code></pre><p>حال در یک تَب ترمینال دیگر با استفاده از دستور <code>adb push</code>، فایل <code>tzdata</code> ساخته شده را به حافظه داخلی گوشی خود انتقال دهید. <strong>توجه داشته باشید که ممکن است مسیر حافظه داخلی گوشی شما با مسیر استفاده شده در این آموزش، متفاوت باشد!</strong></p><pre tabindex=0><code>adb push ~/newtz/output/tzdata /sdcard/tzdata
</code></pre><p>به شِل گوشی برگشته و دستورات زیر را اجرا کنید:</p><pre tabindex=0><code>cd /system/usr/share/zoneinfo # Change the working directory
</code></pre><pre tabindex=0><code>mv tzdata tzdata.old # Backup the old tzdata in case something went wrong
</code></pre><pre tabindex=0><code>mv /sdcard/tzdata tzdata # Move the new tzdata into the current directory
</code></pre><pre tabindex=0><code>chmod 644 tzdata # Change the permissions
</code></pre><p>حال با وارد کردن دستور <code>reboot</code> در شِل گوشی، از حالت ریکاوری خارج شوید. پس از راه‌اندازی مجدد و بوت شدن، به تنظیمات زمان و تاریخ گوشی خود رفته و خودکار بودن منطقه زمانی و تاریخ‌و‌ساعت را بررسی کنید. اگر در حالت خودکار، منطقه زمانی دستگاه نمایانگر <code>Iran Standard Time</code> باشد، فرآیند جایگزینی و بروزرسانی با موفقیت انجام شده است.</p><p><img loading=lazy src=https://files.alireza1219.ir/img/2023/03/new-tzdate-applied.jpg alt="اعمال موفقیت آمیز تغییرات منطقه زمانی"></p><h3 id=اشکال-یابی>اشکال یابی<a hidden class=anchor aria-hidden=true href=#اشکال-یابی>#</a></h3><p>در صورتی که پس از اعمال تغییرات تازه، تمام منطقه‌های زمانی نمایانگر زمان <code>+00:00</code> هستند و عملکرد گوشی شما در مواردی مانند شناسایی سیم‌کارت و شبکه دچار اختلال شده، می‌توانید راه‌های زیر را امتحان کنید:</p><h4 id=دریافت-فایل-از-پیش-گردآوری-شده-tzdata>دریافت فایل از پیش گردآوری شده tzdata<a hidden class=anchor aria-hidden=true href=#دریافت-فایل-از-پیش-گردآوری-شده-tzdata>#</a></h4><p>ابتدا فایل <code>tzdata</code> حاوی آخرین تغییرات منطقه‌های زمانی را از <a href=https://files.alireza1219.ir/files/2023/03/tzdata target=_blank rel="noopener noreferrer">اینجا</a> دریافت کنید. سپس آموزش را از قسمت <a href=#%d8%a7%d9%86%d8%aa%d9%82%d8%a7%d9%84-tzdata-%d8%a8%d9%87-%da%af%d9%88%d8%b4%db%8c>انتقال tzdata به گوشی</a> ادامه دهید.</p><h4 id=چک-کردن-نسخه-zic>چک کردن نسخه zic<a hidden class=anchor aria-hidden=true href=#چک-کردن-نسخه-zic>#</a></h4><p>آیا از ابزار <code>zic</code> درون سیستم‌عامل خود استفاده می‌کنید؟ این احتمال وجود دارد که ابزار zic سیستم‌عامل شما برای نسخه اندرویدتان بیش از اندازه جدید باشد. برای مثال نسخه 2.35 از ابزار <code>zic</code> که به صورت پیش‌فرض در Ubuntu 22.04 LTS وجود دارد، باعث ایجاد مشکل در برخی از گوشی‌های قدیمی شرکت Xiaomi که MIUI 10 را اجرا می‌کنند، می‌شود.</p><p>با اجرای دستور <code>zic --version</code> می‌توانید نسخه فعلی ابزار <code>zic</code> را مشاهده کنید. اگر نسخه نمایان شده بزرگ‌تر از 2.31 بود، می‌توانید آموزش را با یک نسخه قدیمی‌تر نیز امتحان کنید. برای دسترسی به نسخه‌های قدیمی‌تر به دو شکل می‌توان عمل کرد:</p><p>۱- <a href=#%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-%da%a9%d8%b1%d8%af%d9%86-%d8%a7%d8%a8%d8%b2%d8%a7%d8%b1-zic>کامپایل کردن</a> یک نسخه قدیمی از ابزار <code>zic</code></p><p>۲- استخراج ابزار <code>zic</code> از پکیج‌های قدیمی <code>libc</code></p><p>در صورت استفاده از یک توزیع مبتنی بر Debian مانند Ubuntu، بهتر است از روش دوم استفاده کنید. ابتدا نسخه‌های قدیمی پکیج <code>libc</code> را از <a href="https://packages.ubuntu.com/search?keywords=libc-bin" target=_blank rel="noopener noreferrer">اینجا</a> پیدا کرده و پکیج آن را مطابق با معماری پردازنده کامپیوتر خود دانلود کنید. برای مثال روند انجام این کار در یک کامپیوتر با پردازنده ۶۴بیتی و نسخه 2.31 از پکیج <code>libc</code> به شکل زیر است:</p><p>(پیش از شروع دایرکتوری خود را به newtz تغییر دهید)</p><pre tabindex=0><code># Be sure to be in the ~/newtz directory before running the commands below

wget http://security.ubuntu.com/ubuntu/pool/main/g/glibc/libc-bin_2.31-0ubuntu9.7_amd64.deb

dpkg-deb --fsys-tarfile libc-bin_2.31-0ubuntu9.7_amd64.deb | tar -x ./usr/sbin/zic &amp;&amp; mv usr/sbin/zic zic

rm -rf usr
</code></pre><p>حال یک نسخه قابل‌اجرا از ابزار <code>zic</code> در دایرکتوری <code>newtz</code> خواهید داشت. پس از آن، آموزش را از قسمت <a href=#%da%a9%d8%a7%d9%85%d9%be%d8%a7%db%8c%d9%84-%da%a9%d8%b1%d8%af%d9%86-%d9%85%d9%86%d8%b7%d9%82%d9%87%d9%87%d8%a7%db%8c-%d8%b2%d9%85%d8%a7%d9%86%db%8c>کامپایل کردن منطقه‌های زمانی</a> ادامه دهید و توجه کنید که باید دستور این قسمت را به شکل زیر فراخوانی کرده تا از ابزار <code>zic</code> موجود در دایرکتوری <code>newtz</code> جهت کامپایل منطقه‌های زمانی استفاده شود:</p><pre tabindex=0><code>./zic -d data africa antarctica asia australasia etcetera europe northamerica southamerica backward backzone
</code></pre><p>پیش از اجرای دستور فوق بهتر است تا دایرکتوری <code>data</code> را حذف کنید.</p><h4 id=بازگردانی-تغییرات-اعمال-شده>بازگردانی تغییرات اعمال شده<a hidden class=anchor aria-hidden=true href=#بازگردانی-تغییرات-اعمال-شده>#</a></h4><p>در صورت موفقیت‌آمیز نبودن هیچ‌یک راه‌حل‌های مطرح شده، باید فایل قدیمی <code>tzdata</code> را بازگردانی کنید. این به معنای سازگار نبودن آموزش با نسخه اندروید گوشی شما یا استفاده شرکت سازنده دستگاه از روش‌های دیگر جهت ایجاد <code>tzdata</code> می‌باشد.</p><p>جهت بازگردانی فایل <code>tzdata</code> قدیمی، گوشی خود را مجدداً در حالت ریکاوری قرار داده و آن را با کمک کابل به کامپیوتر خود متصل کنید. با استفاده از دستور <code>adb shell</code> به شِل گوشی خود دسترسی پیدا کنید. سپس Mount بودن فایل‌سیستم را بررسی کرده و دستورات زیر را اجرا کنید:</p><pre tabindex=0><code>cd /system/usr/share/zoneinfo
</code></pre><pre tabindex=0><code>rm -rf tzdata
</code></pre><pre tabindex=0><code>mv tzdata.old tzdata
</code></pre><pre tabindex=0><code>reboot
</code></pre><h2 id=سخن-پایانی>سخن پایانی<a hidden class=anchor aria-hidden=true href=#سخن-پایانی>#</a></h2><p>این پست به‌مرور زمان و در مواجهه با چالش‌های تازه یا بهبود راه‌حل‌ها، به‌روزرسانی خواهد شد.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://alireza1219.ir/tags/daylight-saving-time/>Daylight Saving Time</a></li><li><a href=https://alireza1219.ir/tags/android/>Android</a></li></ul><nav class=paginav><a class=next href=https://alireza1219.ir/posts/better-amoozeshyar-extension/><span class=title>صفحه بعدی »</span><br><span>معرفی افزونه آموزشیار بهتر</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer style=padding-bottom:40px><div style=direction:ltr;float:left><span style=font-family:monoton>2023</span> and Counting...</div><div style=direction:ltr;float:right><a style=font-family:monoton;border-bottom:unset href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>HUGO</a> INSIDE</div></footer><script>let hMenu=document.getElementById("menu"),hBtn=document.getElementById("menu-trigger");hBtn.addEventListener("click",function(){hMenu.classList.toggle("hidden")})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="کپی";function s(){t.innerHTML="کپی شد!",setTimeout(()=>{t.innerHTML="کپی"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>